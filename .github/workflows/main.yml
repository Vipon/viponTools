on: [push]
jobs:
  macos-latest-default-debug:
    runs-on: macos-latest
    steps:
      - run: echo "${HOME}/.local/bin" >> $GITHUB_PATH
      - name: Checkout
        uses: actions/checkout@v3
      - run: ./setup.sh
      - name: Configure Debug Xcode
        run: ./configure
      - name: Set Env
        uses: ./.github/actions/set_env
        with:
          shell: bash
          cpath: ${HOME}/.local/include:/usr/local/opt/argp-standalone/include:${CPATH}
          library_path: ${HOME}/.local/lib:/usr/local/opt/argp-standalone/lib/:${LIBRARY_PATH}
      - name: Xcode Built Test Install
        uses: ./.github/actions/xcode_build_test_install
        with:
          shell: bash
          working-directory: output
  macos-latest-gmake-debug:
    runs-on: macos-latest
    steps:
      - run: echo "${HOME}/.local/bin" >> $GITHUB_PATH
      - name: Checkout
        uses: actions/checkout@v3
      - run: ./setup.sh
      - name: Configure Debug Gmake
        run: ./configure --gmake --output gmake
      - name: Set Env
        uses: ./.github/actions/set_env
        with:
          shell: bash
          cpath: ${HOME}/.local/include:/usr/local/opt/argp-standalone/include:${CPATH}
          library_path: ${HOME}/.local/lib:/usr/local/opt/argp-standalone/lib/:${LIBRARY_PATH}
      - name: Gmake Built Test Install
        uses: ./.github/actions/gmake_build_test_install
        with:
          shell: bash
          working-directory: gmake
  macos-latest-ninja-debug:
    runs-on: macos-latest
    steps:
      - run: echo "${HOME}/.local/bin" >> $GITHUB_PATH
      - name: Checkout
        uses: actions/checkout@v3
      - run: ./setup.sh
      - name: Configure Debug Ninja
        run: ./configure --ninja --output ninja
      - name: Set Env
        uses: ./.github/actions/set_env
        with:
          shell: bash
          cpath: ${HOME}/.local/include:/usr/local/opt/argp-standalone/include:${CPATH}
          library_path: ${HOME}/.local/lib:/usr/local/opt/argp-standalone/lib/:${LIBRARY_PATH}
      - name: Ninja Build Test Install
        uses: ./.github/actions/ninja_build_test_install
        with:
          shell: bash
          working-directory: ninja
  macos-latest-gmake-release:
    runs-on: macos-latest
    steps:
      - run: echo "${HOME}/.local/bin" >> $GITHUB_PATH
      - name: Checkout
        uses: actions/checkout@v3
      - run: ./setup.sh
      - name: Configure Gmake Release
        run: ./configure --gmake --release --output gmake_release
      - name: Set Env
        uses: ./.github/actions/set_env
        with:
          shell: bash
          cpath: ${HOME}/.local/include:/usr/local/opt/argp-standalone/include:${CPATH}
          library_path: ${HOME}/.local/lib:/usr/local/opt/argp-standalone/lib/:${LIBRARY_PATH}
      - name: Gmake Built Test Install
        uses: ./.github/actions/gmake_build_test_install
        with:
          shell: bash
          working-directory: gmake_release
      - name: Make Achive
        working-directory: gmake_release
        run: tar -czvf ../viponTools.tar.gz viponTools
      - uses: actions/upload-artifact@v3
        with:
          name: viponTools_macos
          path: viponTools.tar.gz
  ubuntu-2004-gmake-debug:
    runs-on: ubuntu-20.04
    steps:
      - run: echo "${HOME}/.local/bin" >> $GITHUB_PATH
      - name: Checkout
        uses: actions/checkout@v3
      - run: ./setup.sh
      - name: Configure Debug Gmake
        run: ./configure --gmake --output gmake
      - name: Set Env
        uses: ./.github/actions/set_env
        with:
          shell: bash
          cpath: ${HOME}/.local/include:${CPATH}
          library_path: ${HOME}/.local/lib:${LIBRARY_PATH}
      - name: Gmake Built Test Install
        uses: ./.github/actions/gmake_build_test_install
        with:
          shell: bash
          working-directory: gmake
  ubuntu-2004-ninja-debug:
    runs-on: ubuntu-20.04
    steps:
      - run: echo "${HOME}/.local/bin" >> $GITHUB_PATH
      - name: Checkout
        uses: actions/checkout@v3
      - run: ./setup.sh
      - run: chmod 0744 "${HOME}/.local/bin/ninja"
      - name: Configure Debug Ninja
        run: ./configure --ninja --output ninja
      - name: Set Env
        uses: ./.github/actions/set_env
        with:
          shell: bash
          cpath: ${HOME}/.local/include:${CPATH}
          library_path: ${HOME}/.local/lib:${LIBRARY_PATH}
      - name: Ninja Build Test Install
        uses: ./.github/actions/ninja_build_test_install
        with:
          shell: bash
          working-directory: ninja
  ubuntu-2004-gmake-release:
    runs-on: ubuntu-20.04
    steps:
      - run: echo "${HOME}/.local/bin" >> $GITHUB_PATH
      - name: Checkout
        uses: actions/checkout@v3
      - run: ./setup.sh
      - name: Configure Gmake Release
        run: ./configure --gmake --release --output gmake_release
      - name: Set Env
        uses: ./.github/actions/set_env
        with:
          shell: bash
          cpath: ${HOME}/.local/include:${CPATH}
          library_path: ${HOME}/.local/lib:${LIBRARY_PATH}
      - name: Gmake Build Test Install
        uses: ./.github/actions/gmake_build_test_install
        with:
          shell: bash
          working-directory: gmake_release
      - name: Make Achive
        working-directory: gmake_release
        run: tar -czvf ../viponTools.tar.gz viponTools
      - uses: actions/upload-artifact@v3
        with:
          name: viponTools_Ubuntu
          path: viponTools.tar.gz

